---
phase: 04-gemini-integration
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - package.json
  - components/sparkle-effect.tsx
  - components/upload-zone.tsx
autonomous: true

must_haves:
  truths:
    - "User sees 'Making with love...' overlay on image during transformation"
    - "Overlay has dark semi-transparent backdrop with spinner"
    - "Sparkle particles appear around image when transformation completes"
    - "Transformed image fades in smoothly"
  artifacts:
    - path: "components/sparkle-effect.tsx"
      provides: "Sparkle particle animation component"
      exports: ["SparkleEffect"]
    - path: "components/upload-zone.tsx"
      provides: "Enhanced upload zone with progress overlay and sparkles"
      exports: ["UploadZone"]
  key_links:
    - from: "components/upload-zone.tsx"
      to: "components/sparkle-effect.tsx"
      via: "SparkleEffect import"
      pattern: "import.*SparkleEffect.*from"
---

<objective>
Add polished transformation UX with progress overlay and sparkle celebration effect.

Purpose: Create a delightful user experience during AI transformation with "Making with love..." message and cosmic sparkle reveal
Output: Enhanced upload zone with overlay progress indicator and sparkle particle effect
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase context (user decisions)
@.planning/phases/04-gemini-integration/04-CONTEXT.md

# Prior plan summary (Gemini integration must work first)
@.planning/phases/04-gemini-integration/04-01-SUMMARY.md

# Existing component to modify
@components/upload-zone.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install sparkle library and create sparkle effect component</name>
  <files>package.json, components/sparkle-effect.tsx</files>
  <action>
1. Install react-sparkle (lightweight sparkle library):
   ```bash
   npm install react-sparkle
   ```

2. Create `components/sparkle-effect.tsx`:
   ```typescript
   "use client"

   import Sparkle from 'react-sparkle'

   interface SparkleEffectProps {
     active: boolean
   }

   export function SparkleEffect({ active }: SparkleEffectProps) {
     if (!active) return null

     return (
       <div className="absolute inset-0 pointer-events-none overflow-visible">
         <Sparkle
           color="gold"
           count={30}
           minSize={5}
           maxSize={12}
           overflowPx={20}
           fadeOutSpeed={20}
           flicker={true}
         />
       </div>
     )
   }
   ```

   Props:
   - `active`: Controls whether sparkles are visible
   - Gold color matches mystical cosmic theme
   - 30 particles (low overhead, good on mobile)
   - overflowPx allows sparkles to extend beyond container
  </action>
  <verify>
    - `npm ls react-sparkle` shows package installed
    - `components/sparkle-effect.tsx` exists with SparkleEffect export
  </verify>
  <done>
    - react-sparkle installed
    - SparkleEffect component ready with gold cosmic sparkles
  </done>
</task>

<task type="auto">
  <name>Task 2: Add progress overlay and sparkle effect to upload zone</name>
  <files>components/upload-zone.tsx</files>
  <action>
Modify `components/upload-zone.tsx`:

1. Add import at top:
   ```typescript
   import { SparkleEffect } from "@/components/sparkle-effect"
   ```

2. Add new state for sparkle effect (after transformedUrl state):
   ```typescript
   const [showSparkles, setShowSparkles] = useState(false)
   ```

3. Modify handleTransform to trigger sparkles on success:
   - After `setTransformedUrl(result.transformedImage)`, add:
     ```typescript
     // Show sparkles for 3 seconds on successful transform
     setShowSparkles(true)
     setTimeout(() => setShowSparkles(false), 3000)
     ```

4. Update handleReset to clear sparkles:
   - Add `setShowSparkles(false)` to handleReset

5. Add progress overlay INSIDE the preview image container (relative div around img):
   - Wrap the existing `<img>` in a new relative container
   - Add overlay when isTransforming is true:
   ```tsx
   <div className="relative w-full flex justify-center">
     <div className="relative">
       <img
         src={transformedUrl || previewUrl}
         alt={transformedUrl ? "Transformed" : "Preview"}
         className={`max-w-full max-h-[60vh] object-contain rounded-lg shadow-lg dark:shadow-accent/10 transition-opacity duration-500 ${isTransforming ? 'opacity-50' : 'opacity-100'}`}
       />

       {/* Progress overlay */}
       {isTransforming && (
         <div className="absolute inset-0 flex flex-col items-center justify-center bg-black/60 rounded-lg backdrop-blur-sm">
           <Loader2 className="h-8 w-8 text-white animate-spin mb-3" />
           <p className="text-white text-sm font-medium">Making with love...</p>
         </div>
       )}

       {/* Sparkle effect on completion */}
       <SparkleEffect active={showSparkles} />
     </div>
   </div>
   ```

6. Keep the Create button visible but disabled during transformation (already implemented).
   The button text already shows "Creating..." with spinner, which is good as secondary indicator.

Key UX details from CONTEXT.md:
- Dark semi-transparent backdrop (bg-black/60)
- White text with "Making with love..." message
- Spinner accompanies the message
- Image slightly dimmed (opacity-50) under overlay
- Sparkles appear for 3 seconds after success
  </action>
  <verify>
    - `npm run build` completes without errors
    - `npm run dev` starts without errors
  </verify>
  <done>
    - Progress overlay shows "Making with love..." during transformation
    - Overlay has dark backdrop with spinner
    - Gold sparkles appear around image on transformation complete
    - Sparkles fade after 3 seconds
    - Transformed image fades in smoothly (opacity transition)
  </done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build`
2. Manual test flow:
   - Upload an image
   - Click "Create" button
   - Should see dark overlay on image with "Making with love..." and spinner
   - Create button should be disabled and show "Creating..."
   - After transformation completes:
     - Overlay disappears
     - Transformed image fades in
     - Gold sparkles appear around image for ~3 seconds
   - Click "New" to reset (sparkles should clear)
</verification>

<success_criteria>
- Progress overlay displays "Making with love..." message during transformation
- Overlay has dark semi-transparent backdrop with white text and spinner
- Gold sparkle particles celebrate transformation completion
- Sparkles last approximately 3 seconds then fade
- Image transitions smoothly with opacity fade
- No layout shift during transformation states
</success_criteria>

<output>
After completion, create `.planning/phases/04-gemini-integration/04-02-SUMMARY.md`
</output>
