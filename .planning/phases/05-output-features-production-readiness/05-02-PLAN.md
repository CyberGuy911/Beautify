---
phase: 05-output-features-production-readiness
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/api/transform/route.ts
  - vercel.json
autonomous: true

must_haves:
  truths:
    - "Vercel function allows 60 seconds for transformation"
    - "App is deployed and accessible on Vercel"
    - "Environment variables are configured in production"
  artifacts:
    - path: "app/api/transform/route.ts"
      provides: "maxDuration export"
      contains: "maxDuration = 60"
    - path: "vercel.json"
      provides: "Vercel configuration"
      exports: []
  key_links:
    - from: "app/api/transform/route.ts"
      to: "Vercel runtime"
      via: "maxDuration export"
      pattern: "export const maxDuration"
---

<objective>
Production deployment configuration

Purpose: Configure Vercel function timeout to handle Gemini processing delays (up to 60 seconds) and deploy the app to production with proper environment variables.

Output: maxDuration configured in API route, app deployed to Vercel
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-output-features-production-readiness/05-RESEARCH.md

# Key existing file
@app/api/transform/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Vercel function timeout</name>
  <files>app/api/transform/route.ts, vercel.json</files>
  <action>
    1. Add maxDuration export to `app/api/transform/route.ts`:
       - Add at the top of the file, after imports: `export const maxDuration = 60;`
       - This tells Vercel to allow up to 60 seconds for the function

    2. Create `vercel.json` as backup configuration:
       ```json
       {
         "$schema": "https://openapi.vercel.sh/vercel.json",
         "functions": {
           "app/api/transform/route.ts": {
             "maxDuration": 60
           }
         }
       }
       ```
       Note: The route export is the primary method; vercel.json is fallback.

    3. Verify build works with new config:
       ```bash
       npm run build
       ```
  </action>
  <verify>
    - `grep "maxDuration" app/api/transform/route.ts` shows export
    - `cat vercel.json` shows the functions config
    - `npm run build` succeeds
  </verify>
  <done>API route configured with 60-second timeout, vercel.json created</done>
</task>

<task type="auto">
  <name>Task 2: Deploy to Vercel</name>
  <files>None (deployment only)</files>
  <action>
    1. Check if Vercel CLI is available:
       ```bash
       vercel --version || npm install -g vercel
       ```

    2. Link project to Vercel (if not already linked):
       ```bash
       vercel link
       ```
       - If prompted, create new project
       - Project name: beautify (or accept suggestion)

    3. Set environment variables for production:
       ```bash
       # Check if GEMINI_API_KEY is in local env
       # Then add to Vercel
       vercel env add GEMINI_API_KEY production
       vercel env add GEMINI_API_KEY preview
       ```
       Note: If CLI prompts for value, enter the API key.
       If this fails due to missing auth, create a checkpoint.

    4. Deploy to production:
       ```bash
       vercel --prod
       ```

    5. Test the deployed app:
       - Visit the production URL
       - Upload an image
       - Click Create
       - Verify transformation works
       - Download the result
  </action>
  <verify>
    - `vercel ls` shows the project
    - Production URL is accessible
    - Transformation works on production
    - Downloaded file has MsFrozen prefix
  </verify>
  <done>App deployed to Vercel with GEMINI_API_KEY configured, transformation working in production</done>
</task>

</tasks>

<verification>
1. Run `npm run build` locally - must succeed
2. Check maxDuration in route file
3. Visit production URL from `vercel --prod` output
4. Complete full flow: upload -> transform -> compare -> download
5. Verify no timeout errors during transformation
</verification>

<success_criteria>
- maxDuration = 60 exported from API route
- vercel.json exists with backup config
- App deployed to Vercel production
- GEMINI_API_KEY environment variable set
- Full transformation flow works in production
- No 504 timeout errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-output-features-production-readiness/05-02-SUMMARY.md`
</output>
