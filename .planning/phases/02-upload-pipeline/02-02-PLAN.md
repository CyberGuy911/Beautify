---
phase: 02-upload-pipeline
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - components/upload-zone.tsx
  - app/page.tsx
autonomous: true

must_haves:
  truths:
    - "User sees preview of uploaded image"
    - "User can download the uploaded image"
    - "User can upload a new image (reset)"
    - "Interface is responsive on mobile"
    - "Interface is clean and minimal"
    - "User sees progress indicator during upload"
  artifacts:
    - path: "components/upload-zone.tsx"
      provides: "Upload zone with preview, download, reset states"
      exports: ["UploadZone"]
      min_lines: 150
    - path: "app/page.tsx"
      provides: "Page with integrated upload component"
      min_lines: 25
  key_links:
    - from: "components/upload-zone.tsx"
      to: "FileReader API"
      via: "readAsDataURL for preview"
      pattern: "FileReader.*readAsDataURL"
    - from: "components/upload-zone.tsx"
      to: "download anchor"
      via: "data URL in href with download attribute"
      pattern: "download.*href"
    - from: "app/page.tsx"
      to: "components/upload-zone.tsx"
      via: "import and render"
      pattern: "import.*UploadZone"
---

<objective>
Add image preview, download functionality, and progress indicator to upload zone, then integrate into page layout.

Purpose: Complete the upload pipeline proving file handling works end-to-end
Output: Working upload -> preview -> download flow on the main page
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase context
@.planning/phases/02-upload-pipeline/02-CONTEXT.md

# Prior plan in this phase
@.planning/phases/02-upload-pipeline/02-01-SUMMARY.md

# Files to modify
@components/upload-zone.tsx
@app/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add preview display and progress indicator</name>
  <files>components/upload-zone.tsx</files>
  <action>
Extend UploadZone component with preview and loading states:

1. **State management:**
   - Add: `previewUrl: string | null` (data URL for preview)
   - Add: `isLoading: boolean` (reading file)
   - Add: `fileName: string | null` (for download filename)

2. **File reading with progress:**
   - When file accepted, set isLoading=true
   - Use FileReader.readAsDataURL()
   - On load: set previewUrl, isLoading=false
   - Store original fileName for download

3. **Progress indicator:**
   - Show spinner or loading state while isLoading=true
   - Use simple CSS animation (rotate) or lucide Loader2 icon
   - Display in center of upload zone during read

4. **Preview display:**
   - When previewUrl set, show image instead of upload UI
   - Image sizing: max-width: 100%, max-height reasonable (e.g., 60vh)
   - Maintain aspect ratio (object-contain)
   - Center image in available space

5. **Reset capability:**
   - Clear previewUrl/fileName to return to upload state
   - Will be triggered by "Upload New" button (Task 2)

Styling:
- Preview container should feel spacious, image is the focus
- Smooth fade-in for preview image (opacity transition)
- Dark mode: subtle border or shadow around preview
  </action>
  <verify>
1. Upload valid image file
2. See loading indicator briefly
3. See image preview displayed
4. Preview maintains aspect ratio
5. Works in both themes
  </verify>
  <done>
Uploaded images display as preview with loading state during file read
  </done>
</task>

<task type="auto">
  <name>Task 2: Add download and reset functionality</name>
  <files>components/upload-zone.tsx</files>
  <action>
Add action buttons when preview is displayed:

1. **Download button:**
   - Anchor tag styled as button, or Button with asChild
   - href={previewUrl} with download={fileName}
   - Icon: Download from lucide-react
   - Label: "Download" or just icon

2. **Upload New button:**
   - Clears previewUrl, fileName, error states
   - Returns to upload zone state
   - Icon: Upload or RefreshCw from lucide-react
   - Label: "New" or "Upload New" or just icon

3. **Button layout:**
   - Position below preview image
   - Horizontal row with gap
   - Use existing Button component variants (default for download, outline/ghost for new)

4. **Responsive behavior:**
   - Buttons stack vertically on very small screens if needed
   - Or stay horizontal with smaller padding

Do NOT:
- Add transformation button yet (Phase 4)
- Add before/after comparison (Phase 5)
  </action>
  <verify>
1. Upload image, see preview
2. Click Download - file downloads with original name
3. Click "New" - returns to upload state
4. Can upload another image successfully
  </verify>
  <done>
User can download previewed image and reset to upload new image
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate into page and verify responsive layout</name>
  <files>app/page.tsx</files>
  <action>
Replace placeholder upload area with UploadZone component:

1. **Import and render:**
   - Import UploadZone from "@/components/upload-zone"
   - Replace the placeholder div (border-dashed) with UploadZone
   - No onFileAccepted callback needed yet (component manages own state)

2. **Layout adjustments:**
   - Remove or update the "Upload area coming soon" placeholder text
   - Keep the "Transform Your Photos" heading and description
   - UploadZone should fit naturally in the main content area
   - Consider: heading/description above, upload zone below as main focus

3. **Responsive verification:**
   - Test on mobile viewport (Chrome DevTools)
   - Upload zone should be usable on touch devices
   - Preview image scales appropriately
   - Buttons are tap-friendly (min 44px touch target)

4. **Clean minimal interface:**
   - Remove any unnecessary text or UI elements
   - Image should be the focus when previewing
   - Upload state should be inviting but minimal
  </action>
  <verify>
1. `npm run dev` and visit http://localhost:3000
2. See upload zone in main content area
3. Drag-drop works (full viewport)
4. Click browse works
5. Preview displays centered
6. Download works
7. New upload works
8. Test mobile viewport in DevTools - usable
9. Test both light and dark themes
  </verify>
  <done>
Main page displays working upload pipeline with responsive layout
  </done>
</task>

</tasks>

<verification>
- [ ] User can drag-and-drop image onto page
- [ ] User can click to browse for image
- [ ] Invalid formats show error message
- [ ] Valid image shows loading indicator then preview
- [ ] User can download the previewed image
- [ ] User can reset and upload new image
- [ ] Interface works on mobile viewport
- [ ] Interface is clean with focus on image
- [ ] Works in light and dark mode
</verification>

<success_criteria>
Complete upload -> preview -> download flow works on the main page with responsive, minimal interface.
</success_criteria>

<output>
After completion, create `.planning/phases/02-upload-pipeline/02-02-SUMMARY.md`
</output>
